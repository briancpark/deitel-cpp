<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD><TITLE>CMsgThread Class</TITLE>
<STYLE>
<!--
.tctop {color: blue}
.cpslug {color: blue; text-decoration: none}
-->
</STYLE>
<SCRIPT LANGUAGE="JAVASCRIPT">
//<!--
function ShowButtons() {
    if (window.top.frames.length!=0 && window.top.frames[0].ShowButtons!=null)
	window.top.frames[0].ShowButtons('/dssd0231.htm','/dssd0000.htm','/dssd0180.htm','/index.htm','/dssd0233.htm');
}
ShowButtons();
//-->
</SCRIPT>
</HEAD>
<BODY onLoad="ShowButtons()" TOPMARGIN=10 BGPROPERTIES="FIXED" BGCOLOR="#FFFFFF" LINK="#000000" VLINK="#808080" ALINK="#000000">
<FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2">
<H2><A NAME="Lib_0001060234000000">CMsgThread Class</A></H2>
<BR CLEAR=ALL>
<P><IMG SRC="art/mthrd02.gif" WIDTH="179" HEIGHT="24" ALT="CMsgThread class hierarchy" >

<P>This class is a worker thread class that queues requests to the queuing thread for completion
asynchronously. To use this class, derive your class from it and override the 
<A HREF="dssd0232.htm#Lib_0001060234030c00" TARGET="TEXT">CMsgThread::ThreadMessageProc</A> member function.
The <A HREF="dssd0232.htm#Lib_0001060234030c00" TARGET="TEXT">ThreadMessageProc</A> member function carries out each request.
Your client functions and the <B>ThreadMessageProc</B> member function
must share a common definition of the parameters in the <A HREF="dssd0231.htm" TARGET="TEXT">CMsg</A> object.

<P>A negotiated mechanism tells the worker thread to exit. Typically, 
this will be one value of the <A HREF="dssd0231.htm" TARGET="TEXT">CMsg</A> class's <A HREF="dssd0231.htm#Lib_0001060233010004" TARGET="TEXT">uMsg</A> message code.

<P>It is a good idea to send this message from the destructor of your derived class, and call
the <A HREF="dssd0232.htm#Lib_0001060234030d00" TARGET="TEXT">CMsgThread::WaitForThreadExit</A> member function before completing the 
destruction of the derived class.

<A NAME="Lib_0001060234010000"></A><P><B>Protected Data Members</B>
<TABLE BORDER=0>
<TR><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2"><B>Name </B></FONT></TD><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2"><B>Description
</B></FONT></TD></TR><TR><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2"><B><A NAME="Lib_0001060234010001">m_ThreadQueue</A></B>
 </FONT></TD><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2">Overrides the <A HREF="dssd0232.htm#Lib_0001060234030500" TARGET="TEXT">CMsgThread::GetThreadMsg</A> member
function and blocks on things other than this queue.
</FONT></TD></TR><TR><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2"><B><A NAME="Lib_0001060234010002">m_Lock</A></B>
 </FONT></TD><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2">Protects access to lists.
</FONT></TD></TR><TR><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2"><B><A NAME="Lib_0001060234010003">m_hSem</A></B>
 </FONT></TD><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2">Indicates a handle used for signaling.
</FONT></TD></TR><TR><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2"><B><A NAME="Lib_0001060234010004">m_lWaiting</A></B>
 </FONT></TD><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2">Indicates waiting for a free thread.



</FONT></TD></TR></TABLE>
<A NAME="Lib_0001060234020000"></A><P><B>Member Functions</B>
<TABLE BORDER=0>
<TR><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2"><B>Name </B></FONT></TD><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2"><B>Description
</B></FONT></TD></TR><TR><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2"><A HREF="dssd0232.htm#Lib_0001060234030100" TARGET="TEXT">CMsgThread</A> 
 </FONT></TD><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2">Constructs a <A HREF="dssd0232.htm" TARGET="TEXT">CMsgThread</A> object.
</FONT></TD></TR><TR><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2"><A HREF="dssd0232.htm#Lib_0001060234030200" TARGET="TEXT">CreateThread</A> 
 </FONT></TD><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2">Creates a thread.
</FONT></TD></TR><TR><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2"><A HREF="dssd0232.htm#Lib_0001060234030300" TARGET="TEXT">GetThreadHandle</A> 
 </FONT></TD><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2">Returns the thread handle.
</FONT></TD></TR><TR><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2"><A HREF="dssd0232.htm#Lib_0001060234030400" TARGET="TEXT">GetThreadID</A> 
 </FONT></TD><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2">Returns the identifier of the thread.
</FONT></TD></TR><TR><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2"><A HREF="dssd0232.htm#Lib_0001060234030600" TARGET="TEXT">GetThreadPriority</A> 
 </FONT></TD><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2">Retrieves the current thread priority.
</FONT></TD></TR><TR><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2"><A HREF="dssd0232.htm#Lib_0001060234030800" TARGET="TEXT">PutThreadMsg</A> 
 </FONT></TD><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2">Queues a request for execution by the worker thread.
</FONT></TD></TR><TR><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2"><A HREF="dssd0232.htm#Lib_0001060234030900" TARGET="TEXT">ResumeThread</A> 
 </FONT></TD><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2">Continues the operation of the worker thread. 
</FONT></TD></TR><TR><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2"><A HREF="dssd0232.htm#Lib_0001060234030a00" TARGET="TEXT">SetThreadPriority</A> 
 </FONT></TD><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2">Sets the priority of the thread to a new value.
</FONT></TD></TR><TR><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2"><A HREF="dssd0232.htm#Lib_0001060234030b00" TARGET="TEXT">SuspendThread</A> 
 </FONT></TD><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2">Suspends the operation of a running thread.
</FONT></TD></TR><TR><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2"><A HREF="dssd0232.htm#Lib_0001060234030d00" TARGET="TEXT">WaitForThreadExit</A> 
 </FONT></TD><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2">Blocks until the thread has exited after a call to the <A HREF="dssd0232.htm#Lib_0001060234030b00" TARGET="TEXT">CMsgThread::SuspendThread</A>
member function.
</FONT></TD></TR></TABLE>
<A NAME="Lib_0001060234030000"></A><P><B>Overridable Member Functions</B>
<TABLE BORDER=0>
<TR><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2"><B>Name </B></FONT></TD><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2"><B>Description
</B></FONT></TD></TR><TR><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2"><A HREF="dssd0232.htm#Lib_0001060234030500" TARGET="TEXT">GetThreadMsg</A>
 </FONT></TD><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2">Retrieves a queued <A HREF="dssd0231.htm" TARGET="TEXT">CMsg</A> object containing a request.
</FONT></TD></TR><TR><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2"><A HREF="dssd0232.htm#Lib_0001060234030700" TARGET="TEXT">OnThreadInit</A>
 </FONT></TD><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2">Provides initialization on a thread.
</FONT></TD></TR><TR><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2"><A HREF="dssd0232.htm#Lib_0001060234030c00" TARGET="TEXT">ThreadMessageProc</A>
 </FONT></TD><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2">Processes requests. This is a pure virtual member function.
</FONT></TD></TR></TABLE>
<H3><HR COLOR=#0000FF><A NAME="Lib_0001060234030100">CMsgThread::CMsgThread</A></H3>
<A HREF="dssd0232.htm" TARGET="TEXT">CMsgThread Class</A>
<P>Constructs a <A HREF="dssd0232.htm" TARGET="TEXT">CMsgThread</A> object.

<P><B>CMsgThread</B><B>(</B> <B>)</B><B>;</B><BR><H5>Return Values</H5>
<P>No return value.
<H5>Remarks</H5>
<P>Constructing a message thread object does not automatically create the
thread. You must call the <A HREF="dssd0232.htm#Lib_0001060234030200" TARGET="TEXT">CMsgThread::CreateThread</A> member function to create the thread.
<H3><HR COLOR=#0000FF><A NAME="Lib_0001060234030200">CMsgThread::CreateThread</A></H3>
<A HREF="dssd0232.htm" TARGET="TEXT">CMsgThread Class</A>
<P>Creates a thread.

<P><B>BOOL</B> <B>CreateThread</B><B>(</B> <B>)</B><B>;</B><BR><H5>Return Values</H5>
<P>Returns one of the following values.
<TABLE BORDER=0>
<TR><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2"><B>Value </B></FONT></TD><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2"><B> Meaning
</B></FONT></TD></TR><TR><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2">TRUE </FONT></TD><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2">Thread was successfully created.
</FONT></TD></TR><TR><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2">FALSE </FONT></TD><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2">Thread was not successfully created.
</FONT></TD></TR></TABLE>

<H5>Remarks</H5>
<P>The thread will loop, blocking until a request is queued (through 
the <A HREF="dssd0232.htm#Lib_0001060234030800" TARGET="TEXT">CMsgThread::PutThreadMsg</A> member function) and then calling the <A HREF="dssd0232.htm#Lib_0001060234030c00" TARGET="TEXT">CMsgThread::ThreadMessageProc</A> member function with each message.
<H3><HR COLOR=#0000FF><A NAME="Lib_0001060234030300">CMsgThread::GetThreadHandle</A></H3>
<A HREF="dssd0232.htm" TARGET="TEXT">CMsgThread Class</A>
<P>Retrieves the handle to the thread in the <A HREF="dssd0232.htm" TARGET="TEXT">CMsgThread</A> object.

<P><B>HANDLE</B> <B>GetThreadHandle</B><B>(</B> <B>)</B><B>;</B><BR><H5>Return Values</H5>
<P>Returns the thread handle.


<H5>Remarks</H5>
<P>The thread handle can be passed to Microsoft&#174;
Win32&#174; application programming interface (API) functions, such as
<A HREF="dssd0389.htm#external_00010a01090000d9" TARGET="TEXT">WaitForMultipleObjects</A>. The thread handle is signaled when the thread has
exited.
<H3><HR COLOR=#0000FF><A NAME="Lib_0001060234030400">CMsgThread::GetThreadID</A></H3>
<A HREF="dssd0232.htm" TARGET="TEXT">CMsgThread Class</A>
<P>Retrieves the thread's identifier.


<P><B>DWORD</B> <B>GetThreadID</B><B>(</B> <B>)</B><B>;</B><BR><H5>Return Values</H5>
<P>Returns the <I>m_ThreadId</I> private data member.



<H5>Remarks</H5>
<P>This function returns the Microsoft Win32 identifier for the
worker thread. You can call this member function on either the
worker thread or a client thread.
<H3><HR COLOR=#0000FF><A NAME="Lib_0001060234030500">CMsgThread::GetThreadMsg</A></H3>
<A HREF="dssd0232.htm" TARGET="TEXT">CMsgThread Class</A>
<P>Retrieves a queued <A HREF="dssd0231.htm" TARGET="TEXT">CMsg</A> object containing a request.

<P><B>void</B> <B>virtual</B> <B>GetThreadMsg</B><B>(</B><BR>&nbsp;&nbsp;<B>CMsg</B> <I>*msg</I><BR>&nbsp;&nbsp;<B>)</B><B>;</B><BR><H5>Parameters</H5>
<DL><DT><I>msg</I>
 </DT><DD>Pointer to an allocated <A HREF="dssd0231.htm" TARGET="TEXT">CMsg</A> object.
</DD></DL>
<H5>Remarks</H5>
<P>This member function is called from the worker thread's private 
<A HREF="dssd0187.htm#Lib_0001060207020c00" TARGET="TEXT">ThreadProc</A> 
function to retrieve the next member function. The <I>msg</I> parameter should point to an 
allocated <A HREF="dssd0231.htm" TARGET="TEXT">CMsg</A> object that will be filled with the parameters to the next request in the
queue. If there are no queued requests, this member function blocks until the next
request is queued (by a call to the <A HREF="dssd0232.htm#Lib_0001060234030800" TARGET="TEXT">CMsgThread::PutThreadMsg</A> member function).
<H3><HR COLOR=#0000FF><A NAME="Lib_0001060234030600">CMsgThread::GetThreadPriority</A></H3>
<A HREF="dssd0232.htm" TARGET="TEXT">CMsgThread Class</A>
<P>Uses the Microsoft Win32 <B>GetThreadPriority</B> function to
retrieve the priority of the current worker thread. 

<P><B>int</B> <B>GetThreadPriority</B><B>(</B> <B>)</B><B>;</B><BR><H5>Return Values</H5>
<P>Returns the thread priority as an integer.


<H3><HR COLOR=#0000FF><A NAME="Lib_0001060234030700">CMsgThread::OnThreadInit</A></H3>
<A HREF="dssd0232.htm" TARGET="TEXT">CMsgThread Class</A>
<P>Provides initialization on a thread.<P><B>virtual</B> <B>void</B> <B>OnThreadInit</B><B>(</B> <B>)</B><B>;</B><BR><H5>Return Values</H5>
<P>No return value.
<H5>Remarks</H5>
<P>Override this function if you want to do your own specific initialization on thread startup.<H3><HR COLOR=#0000FF><A NAME="Lib_0001060234030800">CMsgThread::PutThreadMsg</A></H3>
<A HREF="dssd0232.htm" TARGET="TEXT">CMsgThread Class</A>
<P>Queues a request for execution by the worker thread.

<P><B>void</B> <B>PutThreadMsg</B><B>(</B><BR>&nbsp;&nbsp;<B>UINT</B> <I>uMsg</I><B>,</B><BR>&nbsp;&nbsp;<B>DWORD</B> <I>dwMsgFlags</I><B>,</B><BR>&nbsp;&nbsp;<B>LPVOID</B> <I>lpMsgParam</I><B>,</B><BR>&nbsp;&nbsp;<B>CAMEvent</B> <I>*pEvent</I> <B>=</B> <B>NULL</B><BR>&nbsp;&nbsp;<B>)</B><B>;</B><BR><H5>Parameters</H5>
<DL><DT><I>uMsg</I>
 </DT><DD>Request code.
</DD><DT><I>dwMsgFlags</I>
 </DT><DD>Optional flags parameter.
</DD><DT><I>lpMsgParam</I>
 </DT><DD>Optional pointer to a data block containing additional parameters or return
values. Must be statically or heap-allocated and not automatic.
</DD><DT><I>pEvent</I>
 </DT><DD>Optional pointer to an event object to be signaled upon completion.
</DD></DL>
<H5>Return Values</H5>
<P>No return value.
<H5>Remarks</H5>
<P>This member function queues a request for execution by the worker thread. The parameters
of this member function will be queued (in a <A HREF="dssd0231.htm" TARGET="TEXT">CMsg</A> object) and passed to the 
<A HREF="dssd0232.htm#Lib_0001060234030c00" TARGET="TEXT">CMsgThread::ThreadMessageProc</A> member function of the worker thread. This member 
function returns immediately after queuing the request and does not wait for the thread to fulfill 
the request. The <B>CMsgThread::ThreadMessageProc</B> member function of the derived class 
defines the four parameters.

<P>This member function uses a multithread safe list, so multiple calls to this member function 
from different threads can be made safely.
<H3><HR COLOR=#0000FF><A NAME="Lib_0001060234030900">CMsgThread::ResumeThread</A></H3>
<A HREF="dssd0232.htm" TARGET="TEXT">CMsgThread Class</A>
<P>Uses the Microsoft Win32 <B>ResumeThread</B> function to
continue the operation of the worker thread after a previous call to the
<A HREF="dssd0232.htm#Lib_0001060234030b00" TARGET="TEXT">CMsgThread::SuspendThread</A> member function.

<P><B>DWORD</B> <B>ResumeThread</B><B>(</B> <B>)</B><B>;</B><BR><H5>Return Values</H5>
<P>If the member function succeeds,
the return value is the previous suspend count of the thread. 
If the member function fails, the return value is 0xFFFFFFFF. 
To obtain extended error information, call the Microsoft
Win32 <A HREF="dssd0389.htm#external_00010a0109000033" TARGET="TEXT">GetLastError</A> function. 

<H3><HR COLOR=#0000FF><A NAME="Lib_0001060234030a00">CMsgThread::SetThreadPriority</A></H3>
<A HREF="dssd0232.htm" TARGET="TEXT">CMsgThread Class</A>
<P>Uses the Microsoft Win32 <B>SetThreadPriority</B> function to
set the priority of the thread to a new value.

<P><B>BOOL</B> <B>SetThreadPriority</B><B>(</B><BR>&nbsp;&nbsp;<B>int</B> <I>nPriority</I><BR>&nbsp;&nbsp;<B>)</B><B>;</B><BR><H5>Parameters</H5>
<DL><DT><I>nPriority</I>
 </DT><DD>Priority of the thread.
</DD></DL>
<H5>Return Values</H5>
<P> Returns one of the following values.
<TABLE BORDER=0>
<TR><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2"><B>Value </B></FONT></TD><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2"><B> Meaning
</B></FONT></TD></TR><TR><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2">TRUE </FONT></TD><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2">Priority was successfully set.
</FONT></TD></TR><TR><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2">FALSE </FONT></TD><TD ALIGN=LEFT VALIGN=TOP><FONT FACE="VERDANA,ARIAL,HELVETICA" SIZE="2">Priority was not set.
</FONT></TD></TR></TABLE>

<H5>Remarks</H5>
<P>The client and the worker thread can call this member function.
<H3><HR COLOR=#0000FF><A NAME="Lib_0001060234030b00">CMsgThread::SuspendThread</A></H3>
<A HREF="dssd0232.htm" TARGET="TEXT">CMsgThread Class</A>
<P>Uses the Microsoft Win32 <B>SuspendThread</B> function to
suspend the operation of a running thread.

<P><B>DWORD</B> <B>SuspendThread</B><B>(</B> <B>)</B><B>;</B><BR><H5>Return Values</H5>
<P>If the member function succeeds, the return value is the previous suspend count of the thread. 
If the member function fails, the return value is 0xFFFFFFFF. To obtain extended error 
information, call the Microsoft Win32 <A HREF="dssd0389.htm#external_00010a0109000033" TARGET="TEXT">GetLastError</A> function. 


<H5>Remarks</H5>
<P>The client thread calls this member function to suspend the operation of the
worker thread. The worker thread remains suspended and will not execute until an
additional call to the <A HREF="dssd0232.htm#Lib_0001060234030900" TARGET="TEXT">CMsgThread::ResumeThread</A> member function is made.
<H3><HR COLOR=#0000FF><A NAME="Lib_0001060234030c00">CMsgThread::ThreadMessageProc</A></H3>
<A HREF="dssd0232.htm" TARGET="TEXT">CMsgThread Class</A>
<P>Processes requests. This is a pure virtual member function. 

<P><B>virtual</B> <B>LRESULT</B> <B>ThreadMessageProc</B><B>(</B><BR>&nbsp;&nbsp;<B>UINT</B> <I>uMsg</I><B>,</B><BR>&nbsp;&nbsp;<B>DWORD</B> <I>dwFlags</I><B>,</B><BR>&nbsp;&nbsp;<B>LPVOID</B> <I>lpParam</I><B>,</B><BR>&nbsp;&nbsp;<B>CAMEvent</B> <I>*pEvent</I><BR>&nbsp;&nbsp;<B>)</B><B>;</B><BR><H5>Parameters</H5>
<DL><DT><I>uMsg</I>
 </DT><DD>Request code.
</DD><DT><I>dwFlags</I>
 </DT><DD>Optional flag parameter to request.
</DD><DT><I>lpParam</I>
 </DT><DD>Optional pointer to extra data or a return data block.
</DD><DT><I>pEvent</I>
 </DT><DD>Optional pointer to an event object.
</DD></DL>
<H5>Return Values</H5>
<P>Any nonzero return causes the thread to exit. Returns zero unless an exit
request has been processed recently.

<H5>Remarks</H5>
<P>This pure virtual function must be overridden in your derived class. It will be
called once for each request queued by a call to the <A HREF="dssd0232.htm#Lib_0001060234030800" TARGET="TEXT">CMsgThread::PutThreadMsg</A> 
member function.

<P>The member function defines the four parameters. Typically, use the <I>uMsg</I> 
parameter to indicate the request, and the other three parameters will be optional additional 
parameters. The calling application can supply a pointer to a <A HREF="dssd0184.htm" TARGET="TEXT">CAMEvent</A> object in the
<I>pEvent</I> parameter if your application requires it. You must set this event after 
processing the event by using an expression such as:
<PRE><FONT FACE="Courier" SIZE="2">pEvent-&gt;SetEvent
</FONT></PRE>
<P>One request code must be set aside to tell the worker thread to exit. Upon receiving this request, 
return 1 from this member function. Return 0 if you do not want the worker thread to exit.
<H3><HR COLOR=#0000FF><A NAME="Lib_0001060234030d00">CMsgThread::WaitForThreadExit</A></H3>
<A HREF="dssd0232.htm" TARGET="TEXT">CMsgThread Class</A>
<P>Blocks until the thread exits.

<P><B>BOOL</B> <B>WaitForThreadExit</B><B>(</B><BR>&nbsp;&nbsp;<B>LPDWORD</B> <I>lpdwExitCode</I><BR>&nbsp;&nbsp;<B>)</B><B>;</B><BR><H5>Parameters</H5>
<DL><DT><I>lpdwExitCode</I>
 </DT><DD>Exit code returned by the thread.
</DD></DL>
<H5>Return Values</H5>
<P>Returns either TRUE or FALSE, the meaning of which is determined by 
the class supplying the overridden <A HREF="dssd0232.htm#Lib_0001060234030c00" TARGET="TEXT">CMsgThread::ThreadMessageProc</A> member function 
and the calling member function.

<H5>Remarks</H5>
<P>Ensure that the worker thread has exited completely before completing the destruction of your derived class; otherwise, the thread might

 still execute after your dynamic-link library (DLL) has been unloaded from the address space of the process. 
Even if the only instruction left to exit is a single-return instruction, this would cause
an exception. The only reliable way to ensure that the thread has exited is to
signal the thread to exit (using a privately negotiated <A HREF="dssd0231.htm" TARGET="TEXT">CMsg</A> object sent to the
<A HREF="dssd0232.htm#Lib_0001060234030800" TARGET="TEXT">CMsgThread::PutThreadMsg</A> member function) and then call this member function. 
You should do this in the destructor for your derived class.
<P><P><FONT FACE="MS SANS SERIF" SIZE="1" COLOR="BLACK">
<A CLASS=cpslug HREF="copyrite.htm" TARGET="TEXT">&#169; 1997 Microsoft Corporation. All rights reserved. Terms of Use.</A>
</FONT>
<BR CLEAR=ALL><P>
</FONT><P>
</BODY></HTML>
